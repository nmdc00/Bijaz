# Release v1.6 Planner

Date: 2026-02-17  
Base Branch: `release/v1.5`  
Release Branch: `release/v1.6`

## Scope Guardrails

- Preserve v1.5 autonomy and safety behavior by default.
- No release-to-main shortcut; promotion remains `release -> develop -> main`.
- One feature branch per task and one PR per branch.
- Any latency optimization that weakens safety gates is out of scope.

## Task Branch Strategy

1. `feat/v1.6-mechanical-expression-selection`
2. `feat/v1.6-market-data-cache`
3. `feat/v1.6-scan-snapshot-reuse`
4. `feat/v1.6-event-driven-scan-triggers`
5. `feat/v1.6-execution-input-validation`
6. `feat/v1.6-retry-classifier-hardening`
7. `feat/v1.6-quote-freshness-control`
8. `feat/v1.6-async-llm-enrichment`
9. `feat/v1.6-performance-telemetry`
10. `feat/v1.6-performance-acceptance-suite`

## Tasks

## 1) Mechanical Expression Selection
Branch: `feat/v1.6-mechanical-expression-selection`

Deliverables:
- Remove blocking LLM selection from autonomous execution path.
- Route candidate filtering entirely through policy engine outputs.
- Preserve reason traces in journal and operator-facing logs.

Acceptance criterion:
- Execution path proceeds without selection-stage LLM round-trip.

Test requirement:
- Unit tests for deterministic selection and integration test with LLM unavailable.

## 2) Market Data Cache
Branch: `feat/v1.6-market-data-cache`

Deliverables:
- Introduce shared cache for mids, funding, positions snapshot, and static metadata.
- Add refresh scheduler and staleness TTLs.
- Expose cache read API for autonomous scan and monitor paths.

Acceptance criterion:
- Sequential fetch fan-out during scan is replaced by cache reads.

Test requirement:
- Cache refresh, expiry, and stale fallback tests.

## 3) Scan Snapshot Reuse
Branch: `feat/v1.6-scan-snapshot-reuse`

Deliverables:
- Create immutable per-cycle snapshot object from cache.
- Reuse the same snapshot across hypothesis/selection/policy/execution stages.
- Record snapshot timestamp and age in cycle traces.

Acceptance criterion:
- Single cycle never mixes multiple market snapshots.

Test requirement:
- Pipeline tests asserting consistent snapshot IDs/timestamps throughout cycle.

## 4) Event-Driven Scan Triggers
Branch: `feat/v1.6-event-driven-scan-triggers`

Deliverables:
- Add immediate scan trigger hook for high-impact intel and market anomalies.
- Add cooldown/dedupe to avoid scan storms.
- Keep interval scheduler path as fallback.

Acceptance criterion:
- Triggered scan starts immediately when event threshold fires.

Test requirement:
- Trigger debounce/cooldown tests and integration coverage for immediate dispatch.

## 5) Execution Input Validation
Branch: `feat/v1.6-execution-input-validation`

Deliverables:
- Normalize execution payloads (trade archetype, exit mode, reduce-only invariants).
- Add strict preflight validation with explicit error taxonomy.
- Persist validation failure reason in journal artifacts.

Acceptance criterion:
- Invalid enum/contract combos fail preflight and do not call order tool.

Test requirement:
- Contract tests for valid and invalid payload combinations.

## 6) Retry Classifier Hardening
Branch: `feat/v1.6-retry-classifier-hardening`

Deliverables:
- Classify tool errors into retryable and terminal.
- Prevent same-cycle retries for terminal failures.
- Add bounded retry count and backoff for retryable failures.

Acceptance criterion:
- Terminal execution errors produce a single attempt + clear incident reason.

Test requirement:
- Table-driven retry behavior tests per error class.

## 7) Quote Freshness Control for IOC
Branch: `feat/v1.6-quote-freshness-control`

Deliverables:
- Add execution quote source with timestamp.
- Enforce quote max-age threshold before placing IOC orders.
- Abort/reprice strategy when quotes are stale.

Acceptance criterion:
- IOC attempts are blocked or repriced when quote age budget is exceeded.

Test requirement:
- Fresh/stale quote decision tests and integration case for stale abort path.

## 8) Async LLM Enrichment
Branch: `feat/v1.6-async-llm-enrichment`

Deliverables:
- Move narrative/thesis enrichment to async post-decision pipeline.
- Add strict enrichment timeout and fallback summary.
- Link enrichment artifacts to executed/blocked decisions.

Acceptance criterion:
- LLM timeout does not block core scan/execution loop.

Test requirement:
- Fault-injection tests with delayed/failed LLM responses.

## 9) Performance Telemetry
Branch: `feat/v1.6-performance-telemetry`

Deliverables:
- Emit per-stage timers and counters for autonomous loop.
- Log and persist p50/p95 latency rollups.
- Add alert thresholds for regression signals.

Acceptance criterion:
- Runtime produces a machine-readable performance summary for each cycle window.

Test requirement:
- Metric emission tests and aggregation correctness tests.

## 10) Performance Acceptance Suite
Branch: `feat/v1.6-performance-acceptance-suite`

Deliverables:
- Add repeatable benchmark harness for representative scenarios.
- Compare v1.6 candidate against v1.5 baseline artifact.
- Gate release with configured latency/error budgets.

Acceptance criterion:
- `release/v1.6` is only releasable when performance budgets are green.

Test requirement:
- CI acceptance workflow test with threshold assertions.

## Multi-Agent Worktree Plan

Use one worktree per agent and one branch per task.

Suggested allocation:
1. Agent A: tasks 1, 8
2. Agent B: tasks 2, 3
3. Agent C: tasks 4, 9
4. Agent D: tasks 5, 6
5. Agent E: tasks 7, 10

Worktree creation template:

```bash
~/.codex/skills/git-multi-worktree-sprint/scripts/create_worktree.sh \
  --repo /home/nmcdc/projects/Thufir-Hawat \
  --base release/v1.6 \
  --branch feat/v1.6-<task-slug> \
  --agent agent-<id> \
  --root /tmp/thufir-worktrees
```

Branch validation before PR:

```bash
/home/nmcdc/.codex/skills/agile-sprint-branching/scripts/check_feature_branches.sh \
  --base origin/release/v1.6 \
  --pattern 'origin/feat/v1.6-*'
```

## Merge Order

1. `feat/v1.6-mechanical-expression-selection`
2. `feat/v1.6-market-data-cache`
3. `feat/v1.6-scan-snapshot-reuse`
4. `feat/v1.6-execution-input-validation`
5. `feat/v1.6-retry-classifier-hardening`
6. `feat/v1.6-quote-freshness-control`
7. `feat/v1.6-event-driven-scan-triggers`
8. `feat/v1.6-async-llm-enrichment`
9. `feat/v1.6-performance-telemetry`
10. `feat/v1.6-performance-acceptance-suite`

## Exit Criteria for v1.6

- All v1.6 task branches merged into `release/v1.6`.
- Performance acceptance suite passes with agreed latency/error budgets.
- No regression in autonomous safety gates and risk controls.
- Release promotion flow completed in order: `release/v1.6 -> develop -> main`.
