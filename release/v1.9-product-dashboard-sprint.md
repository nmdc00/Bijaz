# Sprint: v1.9 Product Dashboard

Date: 2026-02-25  
Release: `v1.9`  
Status: Planned  
Base Branch: `release/v1.9`

## Problem

Thufir now generates high-value paper-trading telemetry (paper trades, component scores, promotion-gate evaluations, and operator snapshot state), but operators still consume this data via CLI/chat surfaces that are not optimized for fast visual diagnosis.

## Sprint Goal

Ship a single-page Product Dashboard backed by SQLite data and a lightweight Express JSON API, with prioritized visibility into performance, risk state, and setup readiness.

## Product Contract

1. Dashboard is one page, operator-first, and loads in one request flow.
2. Backend exposes read-only JSON endpoints from existing SQLite data.
3. Equity chart reflects paper account value over time (cash + unrealized P&L).
4. Open positions display live unrealized P&L and holding time.
5. Trade log surfaces component scores and thesis quality for rapid learning loops.
6. Promotion gate section shows setup-level pass/fail state and distance to readiness.
7. Policy state is visible at a glance (observation mode, caps, remaining budget).
8. Signal performance breakdown supports calibration review by class/regime/session.
9. Dashboard supports global mode segmentation: `paper`, `live`, and `combined`.
10. Dashboard supports global timeframe filtering: day, total/all-time, preset periods, and custom range.

## Visual Direction (Literal)

Theme: desert at sunset.

1. Base palette uses deep dark-blue surfaces and backgrounds.
2. Accent palette uses dark orange/burnt amber for highlights and interaction focus.
3. Data colors remain semantic and readable:
- positive values (profit/pass) in green-family tones
- negative values (loss/fail) in red-family tones
4. Hero area (equity) gets a sunset-style gradient treatment to make the page visually distinctive.
5. Cards/tables should be premium but restrained: high contrast, clean typography, subtle depth, no visual clutter.

Recommended color anchors:
- base navy: `#081826`, `#0E2233`, `#142C3F`
- dark orange accent: `#C86B2A`
- highlight amber: `#E29A43`

## Scope (Priority Order)

1. Equity curve
2. Open positions with live P&L
3. Trade log with component scores
4. Promotion gate status
5. Policy state
6. Signal-class/regime/session performance breakdown
7. Global filters and mode segmentation

## Sprint Task/Branch Plan

1. `feat/v1.9-dashboard-api-foundation`
2. `feat/v1.9-dashboard-equity-curve`
3. `feat/v1.9-dashboard-open-positions`
4. `feat/v1.9-dashboard-trade-log-scores`
5. `feat/v1.9-dashboard-promotion-gates`
6. `feat/v1.9-dashboard-policy-state`
7. `feat/v1.9-dashboard-performance-breakdown`
8. `feat/v1.9-dashboard-frontend-shell`
9. `feat/v1.9-dashboard-integration-acceptance`

## Task Details

## 1) API Foundation
Branch: `feat/v1.9-dashboard-api-foundation`

Deliverables:
- Add dashboard API namespace under gateway server (read-only endpoints).
- Implement SQLite query layer for dashboard DTOs using existing data stores.
- Add response schemas and defensive null/empty handling.
- Add shared query filters for `mode` (`paper|live|combined`) and timeframe (`day|period|all|custom`).

Acceptance criterion:
- `/api/dashboard/*` endpoints return stable JSON shapes with no runtime errors on empty DB state.

Test requirement:
- Endpoint contract tests for status 200, schema shape, and empty-state behavior.

## 2) Equity Curve
Branch: `feat/v1.9-dashboard-equity-curve`

Deliverables:
- Provide time-series endpoint for paper equity (cash + unrealized P&L).
- Support configurable lookback window and fixed sampling interval.
- Expose summary stats (start equity, end equity, drawdown, return).

Acceptance criterion:
- Equity curve endpoint returns chronologically ordered points and accurate summary metrics from fixtures.

Test requirement:
- Deterministic integration tests verifying equity calculations and ordering.

## 3) Open Positions with Live P&L
Branch: `feat/v1.9-dashboard-open-positions`

Deliverables:
- Reuse operator snapshot position state for dashboard table payload.
- Include symbol, side, entry, mark/current, unrealized P&L, and hold duration.
- Include aggregate totals (net unrealized, long/short counts).

Acceptance criterion:
- Open-position rows match operator snapshot state for the same runtime moment.

Test requirement:
- Snapshot parity tests between `/status`-source data and dashboard endpoint output.

## 4) Trade Log with Component Scores
Branch: `feat/v1.9-dashboard-trade-log-scores`

Deliverables:
- Add endpoint for last 20-30 closed paper trades.
- Include direction/timing/sizing/exit scores, R captured, thesis correctness, and close timestamp.
- Include server-side score quality flags for UI coloring.

Acceptance criterion:
- Trade log endpoint returns latest N trades with all score fields populated when available.

Test requirement:
- Query tests for ordering, limit enforcement, and score-field presence.

## 5) Promotion Gate Status
Branch: `feat/v1.9-dashboard-promotion-gates`

Deliverables:
- Add setup-level report payload keyed by `symbol:signalClass`.
- Include trade count, hit rate, expectancy, and per-gate pass/fail flags.
- Provide readiness delta fields (how far from threshold for each failing gate).

Acceptance criterion:
- Each setup row clearly indicates pass/fail and exact missing threshold delta.

Test requirement:
- Gate report tests for passing, failing, and borderline setups.

## 6) Policy State
Branch: `feat/v1.9-dashboard-policy-state`

Deliverables:
- Expose policy state fields: observation mode, leverage cap, drawdown remaining, trades remaining today.
- Include timestamp and source context for operator trust.
- Add explicit unavailable-state values when data is missing.

Acceptance criterion:
- Policy widget is complete in normal mode and explicit (not silent) in degraded-data mode.

Test requirement:
- Policy-state tests for complete, partial, and unavailable scenarios.

## 7) Signal Performance Breakdown
Branch: `feat/v1.9-dashboard-performance-breakdown`

Deliverables:
- Add aggregate performance endpoint by signal class, regime, and session.
- Include sample count, win rate, expectancy, and confidence/coverage hints.
- Return sorting metadata for top/bottom performers.

Acceptance criterion:
- Breakdown endpoint computes aggregates consistently with calibration statistics.

Test requirement:
- Aggregate math tests across class/regime/session fixture sets.

## 8) Frontend Shell (React + Recharts)
Branch: `feat/v1.9-dashboard-frontend-shell`

Deliverables:
- Build single-page React UI consuming dashboard API.
- Implement sections in declared priority order with responsive desktop/mobile layout.
- Use Recharts for equity curve and table-based rendering for all other modules.
- Implement visual system for dark-blue + dark-orange desert-sunset styling.
- Add global control bar with:
  - mode toggle: `Paper | Live | Combined`
  - timeframe toggles: `1D | 7D | 30D | 90D | YTD | All`
  - custom date range picker
- Ensure all modules consume the same global filter state.

Acceptance criterion:
- Dashboard loads all modules from live API, renders meaningful empty/error/loading states, and updates all sections consistently when mode/time filters change.

Test requirement:
- Frontend component tests for data rendering and error/empty handling.

## 9) Integration + Acceptance Harness
Branch: `feat/v1.9-dashboard-integration-acceptance`

Deliverables:
- Add integration test suite for end-to-end dashboard payload consistency.
- Add release checklist for v1.9 dashboard readiness.
- Add smoke command/script for local verification before PR.

Acceptance criterion:
- v1.9 dashboard acceptance suite is green on `release/v1.9`.

Test requirement:
- `vitest` integration coverage for API contracts and core UI render sanity.

## Merge Order

1. `feat/v1.9-dashboard-api-foundation`
2. `feat/v1.9-dashboard-equity-curve`
3. `feat/v1.9-dashboard-open-positions`
4. `feat/v1.9-dashboard-trade-log-scores`
5. `feat/v1.9-dashboard-promotion-gates`
6. `feat/v1.9-dashboard-policy-state`
7. `feat/v1.9-dashboard-performance-breakdown`
8. `feat/v1.9-dashboard-frontend-shell`
9. `feat/v1.9-dashboard-integration-acceptance`

## PR Rules (Enforced)

1. One PR per task branch into `release/v1.9`.
2. No multi-task branches.
3. Each PR must include: scope, changed files, tests run, risk notes, rollback notes.
4. Do not merge if branch diff includes unrelated files.

## Branch Validation Checklist

- Branch cut from `release/v1.9`: yes/no
- Branch maps to one task only: yes/no
- `git diff --name-only release/v1.9...<branch>` is task-scoped: yes/no
- `git rev-list --left-right --count release/v1.9...<branch>` shows branch ahead: yes/no
- Task tests pass: yes/no
- PR body includes scope/tests/risks/rollback: yes/no

If any answer is `no`, do not open PR.

## Exit Criteria

1. All nine task branches are merged into `release/v1.9`.
2. Dashboard displays all six priority sections from live backend data.
3. API endpoints are read-only and schema-stable.
4. Empty-state and degraded-data behavior is explicit across modules.
5. Integration and acceptance tests pass on `release/v1.9`.
6. Promotion flow executed in order: `release/v1.9 -> develop -> main`.
