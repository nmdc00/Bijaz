# v1.6.2: Intent-Safe Execution Gating

## Problem

Chat wording can accidentally trigger mutating trade tools (`perp_place_order`, `perp_cancel_order`) even when the user intent is informational.

This creates execution risk and violates the policy that trading should follow autonomous strategy criteria, not keyword nudges.

## Goal

Ensure chat-origin requests are analysis-only by default and cannot execute mutating trade actions.

Autonomous background trading remains unchanged and continues to execute only when existing strategy/risk criteria pass.

## Scope

1. Add orchestrator execution-origin controls:
- `executionOrigin`: `chat | autonomous | manual_override | system`
- `allowTradeMutations`: boolean

2. Enforce hard guard for chat-origin:
- If `executionOrigin=chat` and `allowTradeMutations=false`, skip mutating trade tools with deterministic reason.

3. Wire conversation path to chat-safe defaults:
- `executionOrigin: 'chat'`
- `allowTradeMutations: false`

4. Add explicit manual override path:
- `/trade confirm <instruction>` maps to:
  - `executionOrigin: 'manual_override'`
  - `allowTradeMutations: true`

5. Preserve existing analytical-intent skip behavior.

## Out of Scope

1. Changes to autonomous scan execution criteria.
2. Policy/risk threshold tuning.

## Acceptance Criteria

1. Chat messages do not execute mutating trade tools by default, including explicit trade phrasing.
2. Autonomous loop can still execute trades under existing criteria.
3. Skip reason is explicit and audit-friendly.
4. Regression tests cover:
- analysis-style skip
- chat-origin hard skip with explicit trade wording
- manual override origin allows trade mutation and tags execution origin in plan context

## Test Plan

1. `pnpm typecheck`
2. `pnpm vitest run tests/agent/orchestrator-autonomous-trade.test.ts`
3. `pnpm vitest run tests/core/conversation-tool-snapshot.test.ts`
