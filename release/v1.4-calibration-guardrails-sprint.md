# Sprint: v1.4 Calibration Guardrails

Date: 2026-02-17  
Base Branch: `test/v1.4-calibration-hardening`  
Integration Branch: `test/v1.4-calibration-hardening`

## Branching Model

1. One task branch per feature.
2. Merge all task branches into `test/v1.4-calibration-hardening`.
3. Run full validation on test branch.
4. Open PR `test/v1.4-calibration-hardening -> release/v1.4`.

## Task Branches

1. `feat/v1.4-calib-min-sample-gates`
2. `feat/v1.4-calib-hierarchical-shrinkage`
3. `feat/v1.4-calib-asymmetric-multipliers`
4. `feat/v1.4-calib-uncertainty-gating`
5. `feat/v1.4-calib-cadence-hysteresis`
6. `feat/v1.4-calib-acceptance-tests`

## Tasks

## 1) Minimum Sample Gates
Branch: `feat/v1.4-calib-min-sample-gates`

Deliverables:
- Add sample-size thresholds for calibration policy tiers.
- Block positive risk scaling below `n=100`.
- Keep conservative down-weighting allowed below threshold.

Acceptance criterion:
- No positive multiplier when resolved sample count is below threshold.

Test requirement:
- Unit tests for thresholds and fallback behavior.

## 2) Hierarchical Shrinkage
Branch: `feat/v1.4-calib-hierarchical-shrinkage`

Deliverables:
- Add hierarchical stats blending (global -> domain/symbol -> session/regime).
- Apply shrinkage weights based on child sample size.
- Ensure micro-buckets cannot dominate policy.

Acceptance criterion:
- Small buckets are blended toward parent values.

Test requirement:
- Metric tests for low/medium/high sample bucket blending.

## 3) Asymmetric Multipliers
Branch: `feat/v1.4-calib-asymmetric-multipliers`

Deliverables:
- Define multiplier tiers where downside adjustment is stronger than upside.
- Add hard caps by evidence tier.
- Emit reason codes for chosen multiplier tier.

Acceptance criterion:
- Upside multiplier remains bounded and stricter than downside logic.

Test requirement:
- Policy tests for low/medium/high evidence tiers.

## 4) Uncertainty-Aware Positive Gating
Branch: `feat/v1.4-calib-uncertainty-gating`

Deliverables:
- Add confidence interval or credible-bound check before positive scaling.
- If uncertainty overlaps neutral edge, force baseline/no-upscale.

Acceptance criterion:
- Positive scaling only when uncertainty check passes.

Test requirement:
- Tests with synthetic edge distributions showing pass/fail gates.

## 5) Policy Cadence and Hysteresis
Branch: `feat/v1.4-calib-cadence-hysteresis`

Deliverables:
- Recompute calibration multipliers on fixed cadence (not every trade).
- Add step-size limits and cooldown to prevent thrash.

Acceptance criterion:
- Multiplier changes are bounded per update cycle.

Test requirement:
- Tests for cadence windows, cooldown, and max step deltas.

## 6) Acceptance Suite
Branch: `feat/v1.4-calib-acceptance-tests`

Deliverables:
- Add integration tests covering sparse data, micro-bucket conditions, uncertainty gates, and hysteresis.
- Add checklist updates for calibration guardrails.

Acceptance criterion:
- New acceptance suite passes and protects against regression.

Test requirement:
- End-to-end tests in `tests/integration`.

## Agent Assignment

1. Agent A: tasks 1 + 6
2. Agent B: task 2
3. Agent C: task 3
4. Agent D: task 4
5. Agent E: task 5

## Merge Order

1. `feat/v1.4-calib-min-sample-gates`
2. `feat/v1.4-calib-hierarchical-shrinkage`
3. `feat/v1.4-calib-asymmetric-multipliers`
4. `feat/v1.4-calib-uncertainty-gating`
5. `feat/v1.4-calib-cadence-hysteresis`
6. `feat/v1.4-calib-acceptance-tests`

## Exit Criteria

1. All task branches merged into `test/v1.4-calibration-hardening`.
2. `pnpm vitest run` passes on integration branch.
3. `pnpm typecheck` passes on integration branch.
4. PR opened from test branch to `release/v1.4`.

