# Release v1.6.1 - LLM Burst Control and Interactive Reliability

Date: 2026-02-17  
Status: Closed (merged into `develop`) with follow-up extension in progress

## Problem

Interactive Telegram turns were stalling at planning while local trivial-task calls timed out and immediately cascaded to remote fallback.  
When heartbeat/proactive jobs overlapped with active chat windows, this amplified provider burst traffic and triggered OpenAI cooldown/rate-limit loops.

## Objectives

1. Reduce non-critical LLM burst amplification.
2. Keep interactive responses responsive under background scheduler load.
3. Preserve deterministic/mechanical fallback behavior when non-critical LLM calls are suppressed.

## Implemented Changes

1. Non-critical fallback suppression by reason:
- Added `agent.nonCriticalFallbackSuppressReasons`.
- Non-critical fallback is now suppressible for configured reasons (`info_digest`, `session_compaction`, `proactive_query_refine`, `proactive_follow_up_queries`).

2. Non-critical reason cooldown throttles:
- Added `agent.nonCriticalReasonCooldownSeconds` with reason-specific cooldown windows.
- Repeated non-critical calls inside cooldown are skipped early with explicit logs.

3. Active-chat suppression windows for scheduled jobs:
- Added `notifications.proactiveSearch.suppressLlmDuringActiveChatSeconds`.
- Added `notifications.heartbeat.suppressLlmDuringActiveChatSeconds`.
- During active chat windows, proactive LLM refinement is disabled and heartbeat LLM generation is deferred.

## Expected Outcome

1. Fewer local-timeout -> remote-fallback cascades.
2. Lower chance of OpenAI rate-limit bursts during active chat.
3. Improved p95 interactive response reliability without removing autonomy loops.

## Closure and Validation

Merged PRs:
1. `#58` `fix(v1.6.1): control non-critical llm burst traffic during active chat`
2. `#59` `fix(v1.6.1): restore develop build and test health`

Post-merge validation on `develop`:
1. `pnpm run build` passed.
2. `pnpm vitest run` passed (`107` files / `335` tests).

Current validated baseline:
1. `d71dee0` on `develop` / `origin/develop`.

## Follow-up Extension (Current Branch)

Branch: `feat/v1.6.1-scheduled-report-jobs` (pivoted to generic scheduled tasks)

1. Add explicit scheduled task commands:
- `/schedule tomorrow 9:45am | <task instruction>`
- `/schedule daily 09:45 | <task instruction>`
- `/schedule every 30m | <task instruction>`
- `/scheduled_tasks`
- `/unschedule_task <id>`
2. Persist scheduled task jobs in DB and rehydrate job handlers on gateway startup.
3. Execute scheduled entries as normal agent tasks (not a report-only path).
4. Add natural-language scheduling-intent guard so time-based requests do not fall into trade execution flow.
