# Release v1.4 Latency Planner (Develop)

Date: 2026-02-17  
Base Branch: `develop`  
Epic: `release/v1.4-latency-epic.md`

## Scope Guardrails

- Keep execution policy deterministic and auditable.
- Do not remove v1.4 risk or calibration protections.
- Keep one feature branch per task, one PR per branch.

## Task Branch Strategy

1. `feat/v1.4-latency-deterministic-selection`
2. `feat/v1.4-latency-market-data-cache`
3. `feat/v1.4-latency-event-driven-triggers`
4. `feat/v1.4-latency-realtime-pricing`
5. `feat/v1.4-latency-integration-benchmarks`

## Tasks

## 1) Deterministic Expression Selection
Branch: `feat/v1.4-latency-deterministic-selection`

Deliverables:
- Add deterministic expression-selection mode in scan execution path.
- Make policy-engine outputs the final execution filter when deterministic mode is enabled.
- Move optional LLM analysis to non-blocking or post-selection path.

Acceptance criterion:
- Scan cycle can execute with zero blocking LLM selection calls in deterministic mode.

Test requirement:
- Unit tests validating identical expression decisions across repeated runs with fixed inputs.

## 2) Shared Market Data Cache
Branch: `feat/v1.4-latency-market-data-cache`

Deliverables:
- Implement cache for mids/funding/positions/equity snapshots with refresh timer.
- Read cached snapshot in scan path instead of sequential direct fetches.
- Add stale-data metadata and fallback behavior in traces.

Acceptance criterion:
- Scan loop reads one snapshot object for market inputs in normal path.

Test requirement:
- Unit tests for refresh cadence, staleness handling, and fallback on refresh failure.

## 3) Event-Driven Triggering (Market Anomalies)
Branch: `feat/v1.4-latency-event-driven-triggers`

Deliverables:
- Add anomaly detector hook (price/volume burst criteria).
- Trigger immediate autonomous scan when anomaly threshold is exceeded.
- Keep cooldown/dedupe to avoid trigger storms.

Acceptance criterion:
- Anomaly event can schedule immediate scan outside fixed interval loop.

Test requirement:
- Tests for trigger thresholds, dedupe windows, and cooldown suppression.

## 4) Real-Time Execution Pricing Inputs
Branch: `feat/v1.4-latency-realtime-pricing`

Deliverables:
- Improve IOC pricing path to use fresher quote data source.
- Add fallback order: real-time quote -> cached quote -> prior path.
- Record quote timestamp age in execution traces.

Acceptance criterion:
- Execution traces include quote source + quote age for each IOC order.

Test requirement:
- Executor tests covering quote-source fallback order and price selection behavior.

## 5) Integration + Benchmark Harness
Branch: `feat/v1.4-latency-integration-benchmarks`

Deliverables:
- Add repeatable benchmark harness for scan latency (median/P95).
- Add integration coverage for deterministic selection + cache + event trigger interactions.
- Add release checklist for latency extension readiness.

Acceptance criterion:
- Benchmark report compares baseline vs extension with deterministic fixture inputs.

Test requirement:
- Deterministic integration tests with no external network dependency.

## Multi-Agent Worktree Plan

Suggested allocation:
1. Agent A: task 1
2. Agent B: task 2
3. Agent C: task 3
4. Agent D: task 4
5. Agent E: task 5

Create worktree template:

```bash
~/.codex/skills/git-multi-worktree-sprint/scripts/create_worktree.sh \
  --repo /home/nmcdc/projects/Thufir-Hawat \
  --base develop \
  --branch feat/v1.4-latency-<task-slug> \
  --agent agent-<id> \
  --root /tmp/thufir-worktrees
```

Branch validation before PR:

```bash
/home/nmcdc/.codex/skills/agile-sprint-branching/scripts/check_feature_branches.sh \
  --base origin/develop \
  --pattern 'origin/feat/v1.4-latency-*'
```

## Merge Order

1. `feat/v1.4-latency-deterministic-selection`
2. `feat/v1.4-latency-market-data-cache`
3. `feat/v1.4-latency-event-driven-triggers`
4. `feat/v1.4-latency-realtime-pricing`
5. `feat/v1.4-latency-integration-benchmarks`

## Exit Criteria

- All five latency task branches merged into `develop`.
- Full test suite is green on `develop`.
- Latency benchmark output is generated and checked in.
- No regression in v1.4 acceptance harness.
