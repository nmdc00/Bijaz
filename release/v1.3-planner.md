# Release v1.3 Planner

Date: 2026-02-16  
Base Branch: `release/v1.2`  
Release Branch: `release/v1.3`

## Scope Guardrails

- Preserve existing v1.2 capabilities; no feature removals.
- Keep news usable as entry triggers (with stricter gating), not risk-only.
- Explicitly exclude the previously proposed `maxDailyDrawdownPct` task from v1.3 scope.

## Task Branch Strategy

Each task is implemented on a dedicated branch cut from `release/v1.3`, then merged back after tests pass.

1. `feat/v1.3-policy-gate`
2. `feat/v1.3-reflection-state-mutation`
3. `feat/v1.3-regime-gating`
4. `feat/v1.3-observation-recovery`
5. `feat/v1.3-signal-performance-tracking`
6. `feat/v1.3-fractional-kelly-sizing`
7. `feat/v1.3-news-entry-gating`
8. `feat/v1.3-cooldown-fallback`
9. `feat/v1.3-integration-acceptance-tests`

## Tasks

## 1) Deterministic Pre-Trade Policy Gate
Branch: `feat/v1.3-policy-gate`

Deliverables:
- Add a hard policy gate before live order execution.
- Block execution when policy constraints fail (without depending on LLM wording).
- Persist explicit block reason in journal/audit artifacts.

Test coverage:
- Unit tests for each gate condition pass/fail path.
- Regression tests showing valid trades still execute.
- Journal assertion tests for blocked outcomes + reasons.

## 2) Reflection -> State Mutation
Branch: `feat/v1.3-reflection-state-mutation`

Deliverables:
- Reflection output writes concrete temporary control changes (e.g., min edge, max entries, leverage cap) for a bounded TTL.
- Runtime consumes mutated controls on next cycles automatically.

Test coverage:
- Unit tests for applying reflection patches to runtime control state.
- TTL expiry tests.
- Integration test proving next cycle reads mutated state.

## 3) Regime Classification and Regime-Signal Compatibility Gate
Branch: `feat/v1.3-regime-gating`

Deliverables:
- Deterministic regime labels: trend, chop, vol expansion, vol compression.
- Signal-class allow/deny matrix by regime.
- Trade block when signal class is disallowed in current regime.

Test coverage:
- Unit tests for regime classifier across representative snapshots.
- Matrix tests for allowed/disallowed signal classes.
- Execution-path test proving disallowed combos cannot place orders.

## 4) Observation-Only Recovery Mode
Branch: `feat/v1.3-observation-recovery`

Deliverables:
- Enter observation-only mode when recent thesis quality degrades (e.g., `thesisCorrect=false` on 3 of last 5).
- In observation mode, run full scan/analyze/journal pipeline but suppress live order execution.

Test coverage:
- Trigger threshold tests.
- Order-suppression tests in observation mode.
- Journal tests for "would-trade" records.

## 5) Signal-Class Performance Tracking
Branch: `feat/v1.3-signal-performance-tracking`

Deliverables:
- Extend trade journal/audit with:
  - `signal_class`
  - `market_regime`
  - `volatility_bucket`
  - `liquidity_bucket`
- Compute rolling metrics by signal class (expectancy, win rate proxy, MAE/MFE proxy, variance proxy).

Test coverage:
- Schema compatibility tests (read old + new rows).
- Metric computation tests on synthetic histories.
- Edge-case tests (insufficient samples, missing fields).

## 6) Fractional Kelly-Based Sizing (Bounded)
Branch: `feat/v1.3-fractional-kelly-sizing`

Deliverables:
- Add bounded fractional Kelly multiplier driven by rolling edge/variance estimates.
- Hard clamp for small-sample uncertainty and max sizing cap.

Test coverage:
- Sizing math unit tests (positive/negative edge, high/low variance).
- Clamp tests (floor/ceiling).
- Regression tests to ensure safe fallback sizing when confidence is low.

## 7) News-Driven Entry Gating (Preserve News as Trigger)
Branch: `feat/v1.3-news-entry-gating`

Deliverables:
- Keep news as valid entry trigger with deterministic checks:
  - novelty threshold
  - market confirmation requirement
  - liquidity/volatility guard
  - expiry window on thesis
- Enforce stricter sizing cap for news-triggered entries.
- Track news subtypes under `signal_class` taxonomy.

Test coverage:
- Gate tests for each required condition.
- Expiry-window tests.
- Sizing-cap tests specific to news entries.

## 8) Cooldown-Safe Monitoring Fallback
Branch: `feat/v1.3-cooldown-fallback`

Deliverables:
- During LLM cooldown, return deterministic monitor/status response (non-empty) built from tool outputs.
- Prevent `Orchestrator returned empty response` in cooldown path.

Test coverage:
- Unit tests simulating `model_cooldown`.
- Conversation-level test asserting non-empty reply under cooldown.
- Regression test ensuring monitoring tools still run.

## 9) Integration and Acceptance Harness
Branch: `feat/v1.3-integration-acceptance-tests`

Deliverables:
- Add end-to-end acceptance tests validating cross-task behavior:
  - policy gate blocks
  - reflection mutation affects next cycle
  - regime mismatch blocks
  - observation mode suppresses execution
  - news-trigger gate behavior
  - cooldown path never emits empty response

Test coverage:
- Full integration suite under `tests/` with deterministic fixtures.
- CI command updates (if needed) to include v1.3 acceptance suite.

## Merge Order

1. `feat/v1.3-policy-gate`
2. `feat/v1.3-reflection-state-mutation`
3. `feat/v1.3-regime-gating`
4. `feat/v1.3-observation-recovery`
5. `feat/v1.3-signal-performance-tracking`
6. `feat/v1.3-fractional-kelly-sizing`
7. `feat/v1.3-news-entry-gating`
8. `feat/v1.3-cooldown-fallback`
9. `feat/v1.3-integration-acceptance-tests`

## Exit Criteria for v1.3

- All task branches merged into `release/v1.3`.
- Full test suite green, including new v1.3 acceptance tests.
- No empty orchestrator responses under simulated provider cooldown.
- New journaling fields populated for new trades without breaking historical reads.
